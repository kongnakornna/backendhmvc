$(function()
{
	prettyPrint();
	setupTooltips();
	$("#streetToggle").on("mouseover mousedown touchstart", showStreetLayer);
	$("#buildingToggle").on("mouseover mousedown touchstart", showBuildingLayer);
	$("#streetToggle, #buildingToggle").on("mouseout touchend", resetLayers);
	$(window).on("mouseup", resetLayers);
	var showLayerCss = {alpha:1, force3D:false, backfaceVisibility:"hidden"},
		hideLayerCss = {alpha:0.1, force3D:false, backfaceVisibility:"hidden"},
		overBgCss = {background:"#CCC"},
		outBgCss = {background:"#EEE"},
		animDuration = 0.5;
	
	
	function setupTooltips()
	{
		var trigger = Utils.isTouchDevice() ? "click" : "hover",
			markerTooltips = $(".tooltip").not(".tooltipstered"),
			len = markerTooltips.length;
	
		for(var i = 0; i < len; i++)
		{
			var markerTooltip = markerTooltips.eq(i);
			markerTooltip.attr("title", markerTooltip.data("title"));
		}
		
		
		if(Utils.browser.name == "Firefox")
		{
			markerTooltips.tooltipster({trigger:"hover", theme: 'tooltipster-shadow'});
			
		}
		else
		{
			markerTooltips.tooltipster({trigger: 'custom',
										triggerOpen: { mouseenter: true },
										triggerClose: { mouseleave: true },
										theme: 'tooltipster-shadow' });
			
		}
		
	}
	
	function showStreetLayer(e)
	{
		TweenMax.to("#streetLayer", animDuration, showLayerCss);
		TweenMax.to("#buildingLayer", animDuration, hideLayerCss);
		TweenMax.to("#streetToggle", animDuration, overBgCss);
		TweenMax.to("#buildingToggle", animDuration, outBgCss);
		
		return false;
	}
	function showBuildingLayer()
	{
		TweenMax.to("#streetLayer", animDuration, hideLayerCss);
		TweenMax.to("#buildingLayer", animDuration, showLayerCss);
		TweenMax.to("#streetToggle", animDuration, outBgCss);
		TweenMax.to("#buildingToggle", animDuration, overBgCss);
		return false;
	}
	
	function resetLayers()
	{
		TweenMax.to("#streetLayer", animDuration, showLayerCss);
		TweenMax.to("#buildingLayer", animDuration, showLayerCss);
		TweenMax.to("#streetToggle", animDuration, outBgCss);
		TweenMax.to("#buildingToggle", animDuration, outBgCss);
	}
	
});